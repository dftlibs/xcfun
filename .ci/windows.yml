steps:
#  - script: |
#      choco install ninja --yes
#      ninja --version
#    displayName: "Install Ninja"

  - task: UsePythonVersion@0
    inputs:
      versionSpec: '$(python.version)'
    displayName: "Using Python version: $(python.version)"

  - script: |
      python -m pip install --upgrade pip pytest numpy
    displayName: 'Pip install Python dependencies'

  - script: |
      call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat" x86_amd64
      cmake -H. -Bbuild ^
            -A x64 ^
            -DCMAKE_BUILD_TYPE=Release ^
            -DCMAKE_INSTALL_PREFIX=./Software/xcfun ^
            -DCMAKE_CXX_COMPILER=cl.exe ^
            -DXCFUN_PYTHON_INTERFACE=ON
    displayName: "Configure XCFun"

  - script: |
      call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat" x86_amd64
      cmake --build build ^
            --config Release ^
            --target install
    displayName: "Build XCFun"

  - script: |
      call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat" x86_amd64
      cd build
      ctest --output-on-failure ^
            -C Release ^
            -E python-interface ^
            --verbose
    displayName: "Test XCFun with CTest"

#  - script: |
#      call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat" x86_amd64
#      set PYTHONPATH=.\Software\xcfun\lib\python;%PYTHONPATH%
#      python -c "import xcfun; print(xcfun.xcfun_splash())"
#    displayName: "Test XCFun Python module"

  # Test we can build the C++ example
  - script: |
      call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat" x86_amd64
      cmake -H.\examples\CXX_host -Bbuild_CXX_host ^
            -G Ninja ^
            -A x64 ^
            -DCMAKE_BUILD_TYPE=Release ^
            -DXCFun_DIR=.\Software\xcfun\CMake ^
            -DCMAKE_CXX_COMPILER=cl.exe
    displayName: "Configure C++ host examples"

  - script: |
      call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat" x86_amd64
      cmake --build build_CXX_host ^
            -- -v -d stats
    displayName: "Build C++ host example"

  # Test we can build the C example
  - script: |
      call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat" x86_amd64
      cmake -H.\examples\C_host -Bbuild_C_host ^
            -G Ninja ^
            -A x64 ^
            -DCMAKE_BUILD_TYPE=Release ^
            -DXCFun_DIR=.\Software\xcfun\CMake ^
            -DCMAKE_C_COMPILER=cl.exe
    displayName: "Configure C host examples"

  - script: |
      call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat" x86_amd64
      cmake --build build_C_host ^
            -- -v -d stats
    displayName: "Build C host example"
